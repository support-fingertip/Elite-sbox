<template>
    <lightning-quick-action-panel header="Product Mapping">
     
    <div style="max-height: 45vh;" class="custompadding">
        <template lwc:if={isLoading}>
            <c-loading-screen></c-loading-screen>
        </template>
        <template lwc:else>
            <div style="padding-bottom:100px">
                <template for:each={productMappingList} for:item="pr" for:index="index">
                    <div  key={pr.index}  class="slds-card border" style="margin-left:5px;margin-right:5px;margin-top:0px;margin-bottom:0px">
                        <!--Buttons For Mobile-->
                        <template if:true={isPhone}>
                            <div class="slds-card__header" style="text-align:right">
                                <!--Delete-->
                                <lightning-button-icon 
                                    icon-name="utility:delete"
                                    onclick={removeProductMappingRow} 
                                    class="slds-m-right_xx-small"
                                    data-index={index}>
                                </lightning-button-icon>
                                <!--Clone-->
                                <lightning-button-icon 
                                    icon-name="utility:copy"
                                    class="slds-m-right_xx-small"
                                    data-index={index}
                                    onclick={cloneProductMappingRow}>
                                </lightning-button-icon>
                                <!--Add-->
                                <lightning-button-icon 
                                    icon-name="utility:add"
                                    onclick={addProductMappingRow}
                                    data-index={index}>
                                </lightning-button-icon>
                            </div>
                        </template>
                        
                        <div class="slds-card__body slds-card__body_inner">
                            <div class="slds-grid slds-wrap">
                                <!--Executive-->
                                <div class={customClass}>
                                    <div class="slds-m-right_xx-small slds-form-element">
                                        <div class="slds-form-element__control">
                                            <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click slds-is-open">
                                                <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                                                    <lightning-input
                                                        label="Executive"
                                                        data-index={index}
                                                        type="search"
                                                        value={pr.Executive_Name__c} 
                                                        data-id="productMapping" 
                                                        read-only={pr.isExecutiveReadOnly}
                                                        class="readonly-bordered"
                                                        message-when-value-missing="Search Executive"
                                                        placeholder="Select Executive"
                                                        onchange={handleExectieSearch}
                                                        required="true">
                                                    </lightning-input> 
                                                </div>
                                                <template lwc:if={pr.isShowExecutiveValues}>
                                                    <div id={pr.index} class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid" role="listbox" aria-label="Placeholder for Dropdown Items" tabindex="0" aria-busy="false">
                                                        <template for:each={searchedExecutives} for:item="srch">
                                                            <ul key={srch.Id} class="slds-listbox slds-listbox_vertical" role="presentation" >
                                                                <li role="presentation" class="slds-listbox__item">
                                                                <div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" role="option" 
                                                                onclick={selectExective} data-id={srch.Id} data-name={srch.Name}  data-index={index}>
                                                                    <lightning-icon 
                                                                        icon-name="standard:avatar" size="small">
                                                                    </lightning-icon>
                                                                    <span class="slds-media__figure slds-listbox__option-icon"></span>
                                                                    <span class="slds-media__body">
                                                                    <span class="slds-truncate" title={srch.Name}>
                                                                        <span>{srch.Name}</span>
                                                                        <br/>
                                                                        <span>{srch.Employee_Code__c}</span>
                                                                    </span>
                                                                    </span>
                                                                </div>
                                                                </li>
                                                            </ul>
                                                        </template>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--Secoundary Fields-->
                                <template if:false={showPrimaryfields}>
                                    <!--Distributor-->
                                    <div class={customClass}>
                                        <div class="slds-m-right_xx-small slds-form-element">
                                            <div class="slds-form-element__control">
                                                <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click slds-is-open">
                                                    <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                                                        <lightning-input
                                                            label="Primary Customer"
                                                            data-index={index}
                                                            type="search"
                                                            read-only={pr.isDistributorReadOnly}
                                                            class="readonly-bordered"
                                                            value={pr.Primary_Customer_Name__c} 
                                                            message-when-value-missing="Search Customer"
                                                            placeholder="Search Customer"
                                                            disabled={pr.disabledistrbutor}
                                                            onchange={handlePrimaryCustomerSearch}
                                                            required="true">
                                                        </lightning-input> 
                                                    </div>
                                                    <template lwc:if={pr.isShowPrimaryCustomerValues}>
                                                        <div  class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid" role="listbox" aria-label="Placeholder for Dropdown Items" tabindex="0" aria-busy="false">
                                                            <template for:each={serchedProductPrimaryCustomers} for:item="srch">
                                                                <ul key={srch.Id} class="slds-listbox slds-listbox_vertical" role="presentation" >
                                                                    <li role="presentation" class="slds-listbox__item">
                                                                    <div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" role="option" 
                                                                    onclick={selectCustomer} data-id={pr.distributorIndex}  data-customertype={srch.Primary_Customer_Type__c}
                                                                    data-name={srch.Name}  data-index={index} data-customerid={srch.Id}  data-executive={pr.Exectuive__c}>
                                                                        <lightning-icon 
                                                                            icon-name="standard:account" size="small">
                                                                        </lightning-icon>
                                                                        <span class="slds-media__figure slds-listbox__option-icon"></span>
                                                                        <span class="slds-media__body">
                                                                        <span class="slds-truncate" title={srch.Name}>
                                                                            <span>{srch.Name}</span><br/>
                                                                             <span>{srch.SAP_Customer_Code__c}</span>
                                                                        </span>
                                                                        </span>
                                                                    </div>
                                                                    </li>
                                                                </ul>
                                                            </template>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--Sub Stockiest-->
                                    <template if:false={isSubstockiest}>
                                        <div class={customClass}>
                                            <div class="slds-m-right_xx-small slds-form-element">
                                                <div class="slds-form-element__control">
                                                    <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click slds-is-open">
                                                        <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                                                            <lightning-input
                                                                label="Sub Stockiest"
                                                                data-index={index}
                                                                type="search"
                                                                value={pr.Sub_Stockiest_Name__c} 
                                                                disabled={pr.isSubstockiestDisabled}
                                                                read-only={pr.isSubStockiestReadOnly}
                                                                class="readonly-bordered"
                                                                message-when-value-missing="Search Sub Stockies"
                                                                placeholder="Search Sub Stockies"
                                                                onchange={handleSubstockiestSearch}>
                                                            </lightning-input> 
                                                        </div>
                                                        <template lwc:if={pr.isShowSubstockistValues}>
                                                            <div  class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid" role="listbox" aria-label="Placeholder for Dropdown Items" tabindex="0" aria-busy="false">
                                                                <template for:each={searchedSubStockiests} for:item="srch">
                                                                    <ul key={srch.Id} class="slds-listbox slds-listbox_vertical" role="presentation" >
                                                                        <li role="presentation" class="slds-listbox__item">
                                                                        <div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" role="option" 
                                                                        onclick={selectSubStockiest} data-name={srch.Name} data-index={index} data-id={srch.Id}>
                                                                            <lightning-icon 
                                                                                icon-name="standard:account" size="small">
                                                                            </lightning-icon>
                                                                            <span class="slds-media__figure slds-listbox__option-icon"></span>
                                                                            <span class="slds-media__body">
                                                                            <span class="slds-truncate" title={srch.Name}>
                                                                                <span>{srch.Name}</span>
                                                                                <span>{srch.Customer_Code__c}</span>
                                                                            </span>
                                                                            </span>
                                                                        </div>
                                                                        </li>
                                                                    </ul>
                                                                </template>
                                                            </div>
                                                        </template>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </template>
                                <!--Primary Fields-->
                                <template if:true={showPrimaryfields}>
                                    <!--Sales Channel-->
                                    <div class={customClass}>
                                        <lightning-combobox
                                            label="Sales Channel"
                                            data-index={index}
                                            data-id="productMapping" 
                                            name="Chanel__c"
                                            value={pr.Chanel__c}
                                            dropdown-alignment="auto"
                                            options={pr.productMappingchannelOptions}
                                            message-when-value-missing="Select Channel"
                                            placeholder="Select option"
                                            required="true"
                                            onchange={handleInputProductMappingChange}>
                                        </lightning-combobox>
                                    </div>
                                    <!--Teritory-->
                                    <div class={customClass}>
                                        <div class="slds-m-right_xx-small slds-form-element">
                                            <div class="slds-form-element__control">
                                                <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click slds-is-open">
                                                    <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                                                        <lightning-input
                                                            label="Territory"
                                                            data-index={index}
                                                            type="search"
                                                            name="Area_Name__c"
                                                            value={pr.Area_Name__c} 
                                                            read-only={pr.isTerritoryReadOnly}
                                                            class="readonly-bordered"
                                                            data-id="productMapping" 
                                                            message-when-value-missing="Search Territory"
                                                            placeholder="Select Territory"
                                                            onchange={handleAreaSearch}
                                                            required="true">
                                                        </lightning-input> 
                                                    </div>
                                                    <template lwc:if={pr.isShowAreaValues}>
                                                        <div id={pr.index} class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid" role="listbox" aria-label="Placeholder for Dropdown Items" tabindex="0" aria-busy="false">
                                                            <template for:each={searchedAreas} for:item="srch">
                                                                <ul key={srch.Id} class="slds-listbox slds-listbox_vertical" role="presentation" >
                                                                    <li role="presentation" class="slds-listbox__item">
                                                                    <div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" role="option" 
                                                                    onclick={selectArea} data-id={srch.Id} data-name={srch.Name}  data-index={index}>
                                                                        <lightning-icon 
                                                                            icon-name="standard:product_service_campaign_item" size="small">
                                                                        </lightning-icon>
                                                                        <span class="slds-media__figure slds-listbox__option-icon"></span>
                                                                        <span class="slds-media__body">
                                                                        <span class="slds-truncate" title={srch.Name}>
                                                                            <span>{srch.Name}</span>
                                                                        </span>
                                                                        </span>
                                                                    </div>
                                                                    </li>
                                                                </ul>
                                                            </template>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--PDP Day-->
                                    <div class={customClass}>
                                        <lightning-combobox
                                            label="PDP Day"
                                            data-index={index}
                                            data-id="productMapping" 
                                            name="PDP_Day__c"
                                            value={pr.PDP_Day__c}
                                            dropdown-alignment="auto"
                                            options={pdpDayList}
                                            message-when-value-missing="Select PDP day"
                                            placeholder="Select option"
                                            onchange={handleInputProductMappingChange}>
                                        </lightning-combobox>
                                    </div>
                                    <!--Parent Deport-->
                                    <div class={customClass}>
                                        <lightning-combobox
                                        label="Sales Organization"
                                        data-index={index}
                                        data-id="productMapping" 
                                        name="Parent_Depot__c"
                                        value={pr.Parent_Depot__c}
                                        dropdown-alignment="auto"
                                        options={ParentDeportOptions}
                                        message-when-value-missing="Select Sales Organization"
                                        placeholder="Select option"
                                        required="true"
                                        onchange={handleInputProductMappingChange}>
                                        </lightning-combobox>
                                    </div>
                                    <!--Child Deport-->
                                    <div class={customClass}>
                                        <lightning-combobox
                                            label="Delivery Plant"
                                            data-index={index}
                                            data-id="productMapping" 
                                            name="Child_Depot__c"
                                            value={pr.Child_Depot__c}
                                            dropdown-alignment="auto"
                                            options={pr.childDeportOptions}
                                            message-when-value-missing="Select Delivery Plant"
                                            placeholder="Select option"
                                            required="true"
                                            disabled={pr.disableChildDeprort}
                                            onchange={handleInputProductMappingChange}>
                                        </lightning-combobox>
                                    </div>
                                    <!--Sales Office-->
                                    <div class={customClass}>
                                        <lightning-combobox
                                            label="Sales Office"
                                            data-index={index}
                                            data-id="productMapping" 
                                            name="Sales_Office__c"
                                            value={pr.Sales_Office__c}
                                            dropdown-alignment="auto"
                                            options={salesOfficeList}
                                            message-when-value-missing="Select Sales Office"
                                            placeholder="Select option"
                                            required="true"
                                            onchange={handleInputProductMappingChange}>
                                        </lightning-combobox>
                                    </div>
                                    <!--Division-->
                                    <div class={customClass}>
                                        <lightning-combobox
                                            label="Division"
                                            data-index={index}
                                            data-id="productMapping" 
                                            name="Division__c"
                                            value={pr.Division__c}
                                            dropdown-alignment="auto"
                                            options={divisionList}
                                            message-when-value-missing="Select Division"
                                            placeholder="Select option"
                                            required="true"
                                            onchange={handleInputProductMappingChange}>
                                        </lightning-combobox>
                                    </div>
                                    <!--Order Type-->
                                    <div class={customClass}>
                                        <lightning-combobox
                                            label="Order Type"
                                            data-index={index}
                                            data-id="productMapping" 
                                            name="Order_Type__c"
                                            value={pr.Order_Type__c}
                                            dropdown-alignment="auto"
                                            options={orderTypeList}
                                            message-when-value-missing="Select Order Type"
                                            placeholder="Select option"
                                            required="true"
                                            onchange={handleInputProductMappingChange}>
                                        </lightning-combobox>
                                    </div>
                                    <!--Distribution Channel-->
                                    <div class={customClass}>
                                        <lightning-combobox
                                            label="Distribution Channel"
                                            data-index={index}
                                            data-id="productMapping" 
                                            name="Distribution_Channel__c"
                                            value={pr.Distribution_Channel__c}
                                            dropdown-alignment="auto"
                                            options={distributonChannelList}
                                            message-when-value-missing="Select Distribution Channel"
                                            placeholder="Select option"
                                            required="true"
                                            onchange={handleInputProductMappingChange}>
                                        </lightning-combobox>
                                    </div>
                                    <!--Payment Term-->
                                    <div class={customClass}>
                                        <lightning-combobox
                                            label="Payment Term"
                                            data-index={index}
                                            data-id="productMapping" 
                                            name="Payment_Term__c"
                                            value={pr.Payment_Term__c}
                                            dropdown-alignment="auto"
                                            options={paymemtTermList}
                                            message-when-value-missing="Select Payment Term"
                                            placeholder="Select option"
                                            required={mandatepaymentInfo}
                                            onchange={handleInputProductMappingChange}>
                                        </lightning-combobox>
                                    </div>
                                    <!--Credit Description-->
                                    <div class={customClass}>
                                        <lightning-combobox
                                            label="Credit Description"
                                            data-index={index}
                                            data-id="productMapping" 
                                            name="Credit_Description__c"
                                            value={pr.Credit_Description__c}
                                            dropdown-alignment="auto"
                                            options={pr.creditDescriptions}
                                            message-when-value-missing="Select Credit Description"
                                            placeholder="Select option"
                                            
                                            disabled="true"
                                            onchange={handleInputProductMappingChange}>
                                        </lightning-combobox>
                                    </div>
                                    <!--Inco Terms-->
                                    <div class={customClass}>
                                        <lightning-combobox
                                            label="Inco Terms"
                                            data-index={index}
                                            data-id="productMapping" 
                                            name="Inco_Terms__c"
                                            value={pr.Inco_Terms__c}
                                            dropdown-alignment="auto"
                                            options={incotermList}
                                            message-when-value-missing="Select Inco Terms"
                                            placeholder="Select option"
                                            required="true"
                                            onchange={handleInputProductMappingChange}>
                                        </lightning-combobox>
                                    </div>
                                </template>
                                <!--Desktop Buttons-->
                                <template if:true={isDesktop}>
                                    <div class={buttoncustomClass} style="text-align: right;padding-top:25px">
                                        <!--Delete Icon-->
                                        <lightning-button-icon 
                                            icon-name="utility:delete"
                                            class="slds-m-right_xx-small"
                                            data-index={index}
                                            onclick={removeProductMappingRow}>
                                        </lightning-button-icon>

                                        <!--Clone-->
                                        <lightning-button-icon 
                                            icon-name="utility:copy"
                                            class="slds-m-right_xx-small"
                                            data-index={index}
                                            onclick={cloneProductMappingRow}>
                                        </lightning-button-icon>

                                        <!--New Button-->
                                        <lightning-button-icon 
                                            icon-name="utility:add"
                                            onclick={addProductMappingRow}
                                            data-index={index}>
                                        </lightning-button-icon>
                                    </div>
                                </template>
                               
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </template>
    
    </div>
        <div slot="footer" class="footer">
            <lightning-button variant="neutral" label="Cancel"  class="custom-button"  onclick={handleCancel}></lightning-button>
            <lightning-button variant="brand" label="Save"  class="custom-button" style="padding-left:5px" onclick={handleSave}></lightning-button>
        </div>
    </lightning-quick-action-panel>
  </template>