<template>
    <div class="slds-combobox_container">
        <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click slds-is-open" role="combobox">
            
            <!-- Search Input with icon and clear -->
            <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right">
                <lightning-input
                    label={label}
                    value={searchKey}
                    type="search"
                    placeholder={placeholder}
                    onchange={handleSearchChange}
                    class="lookup-input"
                ></lightning-input>
            </div>

            <!-- Dropdown -->
            <template if:true={showDropdown}>
                <div class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid" role="listbox">
                    <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                        <template for:each={results} for:item="record">
                            <li key={record.Id} role="presentation" class="slds-listbox__item">
                                <div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small"
                                     role="option"
                                     onclick={handleSelect}
                                     data-id={record.Id}
                                     data-name={record.Name}
                                     data-index={dataIndex}
                                     >
                                    <lightning-icon
                                        icon-name={iconName}
                                        size="small"
                                        class="slds-icon slds-icon_small slds-listbox__option-icon slds-m-right_small">
                                    </lightning-icon>
                                    <span class="slds-media__body">
                                        <span class="slds-truncate" title={record.Name}>{record.Name}</span>
                                    </span>
                                </div>
                            </li>
                        </template>
                    </ul>
                </div>
            </template>
        </div>
    </div>
</template>