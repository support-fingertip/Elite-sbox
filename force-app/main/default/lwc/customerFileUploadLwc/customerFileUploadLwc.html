<template>
    <lightning-card title={cardTitle}>
        <!-- Spinner -->
        <template lwc:if={isLoading}>
            <div style="overflow: hidden;">
                <c-loading-screen size="3" ></c-loading-screen>
            </div>
        </template>
        <template lwc:else>
            <template if:false={childComponent}>
                <!-- Toggle Button -->
                <div class="slds-p-around_medium">
                    
                    <lightning-button label={toggleLabel} onclick={toggleShowFiles} variant="brand"></lightning-button>
                </div>
            </template>

            <template if:true={showFiles}>
                <template lwc:if={showCameraModal}>
                    <div class={cameraclss}>
                        <c-capture-image-lwc
                            record-id={recordId}
                            unique-id={uniqueId}
                            open-camera-value="true"
                            oncamerastopped={handleCameraStopped}>
                        </c-capture-image-lwc>
                    </div>
                </template>
                <template lwc:else>
                    <template for:each={fileCategories} for:item="category">
                        <div key={category.name} class=" slds-text-align_center slds-box" style="margin-left: 10px;margin-right:10px">
                            <h3 class="slds-text-heading_small slds-text-title_bold"><b>{category.label}</b></h3>
                            <template lwc:if={category.showCamera}>
                                <template if:true={isDesktop}>
                                    <!-- File Upload -->
                                    <lightning-file-upload
                                        label="Upload File"
                                        required={category.required}
                                        name={category.name}
                                        record-id={recordId}
                                        multiple
                                        onuploadfinished={handleUploadFinished}>
                                    </lightning-file-upload>
                                </template>
                                <template if:true={isPhone}>
                                    <div class="icon-container" onclick={openCameraForCategory}>
                                        <lightning-icon icon-name="action:add_photo_video" size="small" class="icon"></lightning-icon>
                                        <div class="icon-label">Open Camera</div>
                                    </div>
                                </template>
                            </template>
                            <template lwc:else>
                                <!-- File Upload -->
                                <lightning-file-upload
                                    label="Upload File"
                                    name={category.name}
                                    record-id={recordId}
                                    required={category.required}
                                    multiple
                                    onuploadfinished={handleUploadFinished}>
                                </lightning-file-upload>
                            </template>
                    
                            <!-- Uploaded File List -->
                            <template if:true={category.hasFiles}>
                                <table class="slds-table slds-table_bordered slds-table_fixed-layout slds-m-top_small slds-m-bottom_small">
                                    <tbody>
                                        <template for:each={category.files} for:item="file">
                                            <tr key={file.Id}>
                                                <td class="slds-cell-wrap" width="80%">
                                                    <a href="javascript:void(0);" data-id={file.Id} onclick={previewFile}>
                                                        {file.Title}
                                                    </a>
                                                </td>
                                                <template if:true={showDelete}>
                                                    <td width="20%">
                                                        <lightning-button-icon
                                                            icon-name="utility:delete"
                                                            data-id={file.Id}
                                                            data-category={category.name}
                                                            onclick={deleteFile}
                                                            alternative-text="Delete"
                                                            title="Delete"
                                                        ></lightning-button-icon>
                                                    </td>
                                                </template>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </template>
                        </div>
                    </template>
                </template>
           </template>
        </template>
    </lightning-card>
</template>