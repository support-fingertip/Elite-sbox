<template>
    <div class="outlets">
        <!-- When page is loading -->
        <template lwc:if={isLoading}>
            <c-on-loading-screen></c-on-loading-screen>
        </template>
        <!--once Page Loaded-->
        <template lwc:else>
            <div class="dropdown">
                <div class="dropdown-head">
                    <div class="dropdown-head-left">
                        <h4 class="dropdown-head-title">Payment Followup Details</h4>
                    </div>
                </div>
                <div class="task-head-button">
                    <div class="task-button pointer" data-name="Add" onclick={handleOnclickMenu}>Add Payment Followup</div>
                </div>
                <template lwc:if={paymentDataExisted}>
                    <div class="route">
                        <template for:each={paymentData} for:item="item" for:index="index">
                            <div class="competiton-body" key={item.id}>
                                <div class="borderLine">
                                    <div  class="route-outlet" >
                                        <div class="route-left pointer" data-id={item.id} onclick={openPopupDetails}>
                                            <!--<div class="outlet-row">
                                                <span class="outlet-label">Payment Followup Id</span>
                                                <span>:</span>
                                                <span class="outlet-value">{item.name}</span>
                                            </div>-->
                                            <div class="outlet-row">
                                                <span class="outlet-label">Expected Amount</span>
                                                <span>:</span>
                                                <span class="outlet-value">{item.expectedAmount}</span>
                                            </div>
                                            <div class="outlet-row">
                                                <span class="outlet-label">Expected Payment Date</span>
                                                <span>:</span>
                                                <span class="outlet-value">{item.expectedPaymentDate}</span>
                                            </div>
                                            <div class="outlet-row">
                                                <span class="outlet-label">Comments</span>
                                                <span>:</span>
                                                <span class="outlet-value">{item.comments}</span>
                                            </div>
                                      
                                        </div>
                                        
                                        <!--More-->
                                        <div class="right"  >
                                            <svg class="outlet-icon" width="24" data-id={item.id} data-index={index}  onclick={openMenu} height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M12 5.92C12.2546 5.92 12.4988 5.81886 12.6789 5.63882C12.8589 5.45879 12.96 5.21461 12.96 4.96C12.96 4.70539 12.8589 4.46121 12.6789 4.28118C12.4988 4.10114 12.2546 4 12 4C11.7454 4 11.5013 4.10114 11.3212 4.28118C11.1412 4.46121 11.04 4.70539 11.04 4.96C11.04 5.21461 11.1412 5.45879 11.3212 5.63882C11.5013 5.81886 11.7454 5.92 12 5.92ZM12 12.96C12.2546 12.96 12.4988 12.8589 12.6789 12.6788C12.8589 12.4988 12.96 12.2546 12.96 12C12.96 11.7454 12.8589 11.5012 12.6789 11.3212C12.4988 11.1411 12.2546 11.04 12 11.04C11.7454 11.04 11.5013 11.1411 11.3212 11.3212C11.1412 11.5012 11.04 11.7454 11.04 12C11.04 12.2546 11.1412 12.4988 11.3212 12.6788C11.5013 12.8589 11.7454 12.96 12 12.96ZM12 20C12.2546 20 12.4988 19.8989 12.6789 19.7188C12.8589 19.5388 12.96 19.2946 12.96 19.04C12.96 18.7854 12.8589 18.5412 12.6789 18.3612C12.4988 18.1811 12.2546 18.08 12 18.08C11.7454 18.08 11.5013 18.1811 11.3212 18.3612C11.1412 18.5412 11.04 18.7854 11.04 19.04C11.04 19.2946 11.1412 19.5388 11.3212 19.7188C11.5013 19.8989 11.7454 20 12 20Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                            <!-- Popup menu -->
                                            <template lwc:if={item.openPopup}>
                                                <div class="popup" id={index}>
                                                    <ul>
                                                        <li onclick={handleOnclickMenu} data-name="Add" data-id={item.id} data-index={index}>
                                                            <i class="material-symbols-outlined">
                                                                <lightning-icon 
                                                                        icon-name="utility:add" 
                                                                        size="x-small" 
                                                                        alternative-text="Add"
                                                                        class="invert-image" 
                                                                        ></lightning-icon>
                                                            </i>
                                                            Add
                                                        </li>
                                                        <li onclick={handleOnclickMenu} data-name="Edit" data-id={item.id} data-index={index}>
                                                            <i class="material-icons">
                                                                <lightning-icon 
                                                                                icon-name="utility:edit" 
                                                                                size="x-small" 
                                                                                alternative-text="Edit"
                                                                                class="invert-image"
                                                                                >
                                                                </lightning-icon>
                                                            </i>
                                                            Edit
                                                        </li > 
                                                        <li onclick={handleOnclickMenu} data-name="Delete" data-id={item.id} data-index={index}>
                                                            <i class="material-icons">
                                                                <lightning-icon 
                                                                                icon-name="utility:delete" 
                                                                                size="x-small" 
                                                                                alternative-text="Delete"
                                                                                class="invert-image"
                                                                                >
                                                                </lightning-icon>
                                                            </i>
                                                            Delete
                                                        </li >                                  
                                                    </ul>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template> 
                        <!-- Popup Modal -->
                        <template lwc:if={showPopup}>
                            <div class="popup-overlay">
                                <div class="popup-content">
                                    <h3><b>Payment Followup Details</b></h3>
                                    <div class="popup-row">
                                        <span class="popup-label">Payment Followup Id</span>
                                        <span>:</span>
                                        <span class="popup-value">{selectedItem.name}</span>
                                    </div>
                                    <div class="popup-row">
                                        <span class="popup-label">Expected Amount</span>
                                        <span>:</span>
                                        <span class="popup-value">{selectedItem.expectedAmount}</span>
                                    </div>
                                    <div class="popup-row">
                                        <span class="popup-label">Exp. Pay Date</span>
                                        <span>:</span>
                                        <span class="popup-value">{selectedItem.expectedPaymentDate}</span>
                                    </div>
                                    <div class="popup-row">
                                        <span class="popup-label">Comments</span>
                                        <span>:</span>
                                        <span class="popup-value">{selectedItem.comments}</span>
                                    </div>
                               
                                    <button class="close-btn" onclick={closePopup}>Close</button>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
            <!-- Edit/Add Comeptition Popup -->
            <template if:true={isModalOpen}>
                <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                    <div class={containerClass}>
                        <template lwc:if={isDesktop}>
                            <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" onclick={closeModal}>
                                <lightning-icon icon-name="utility:close" size="small"></lightning-icon>
                                <span class="slds-assistive-text">Close</span>
                            </button>
                        </template>
                        <!-- Modal/Popup Header -->
                        <header class="slds-modal__header">
                            <div class="slds-grid slds-gutters">
                                <template if:false={isDesktop}>
                                    <div class="slds-col  slds-clearfix">
                                        <div class="slds-float_left">
                                            <lightning-button variant="base" label="Save"   onclick={savePaymentFollowup} class="slds-m-left_x-small"></lightning-button>
                                        </div>
                                    </div>
                                </template>
                                <div class="slds-col slds-align_absolute-center">
                                    <h1 id="modal-heading-02" class="slds-modal__title slds-hyphenate small-modal-title" tabindex="-1">{modalTitle}</h1>
                                </div>
                                
                                <template if:false={isDesktop}>
                                    <div class="slds-col  slds-clearfix">
                                        <div class="slds-float_right">
                                            <lightning-button variant="base" label="Cancel"  onclick={closeModal} class="slds-m-left_x-small"></lightning-button>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </header>

                        <!-- Modal Body -->
                        <div class="slds-modal__content slds-p-around_medium">
                            <div class="slds-grid slds-wrap slds-grid_pull-padded-x-small"> 
                        
                                <!-- Expected Amount -->
                                <div class="slds-size_1-of-1 slds-p-horizontal_small">
                                    <lightning-input
                                        label="Expected Amount"
                                        type="text"
                                        value={expectedAmount} 
                                        data-id="expectedAmount"
                                        onchange={handleInputChange}
                                        required="true">
                                    </lightning-input> 
                                </div>
                                <!--Expected Payment Date-->
                                <div class="slds-size_1-of-1 slds-p-horizontal_small">
                                    <lightning-input
                                        label="Expected Payment Date"
                                        type="Date"
                                        value={expectedPaymentDate} 
                                        data-id="expectedPaymentDate"
                                        onchange={handleInputChange}
                                        required="true">
                                    </lightning-input> 
                                </div>
                                <div class="slds-size_1-of-1 slds-p-horizontal_small">
                                    <lightning-textarea 
                                        label="Comments"
                                        value={comments}
                                        required="true"
                                        onchange={handleInputChange}
                                        data-id="comments">
                                    </lightning-textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Modal Footer -->
                        <template lwc:if={isDesktop}>
                            <footer class="slds-modal__footer">
                                <button class="slds-button slds-button_neutral" onclick={closeModal}>Cancel</button>
                                <button class="slds-button slds-button_brand" onclick={savePaymentFollowup}>Save</button>
                            </footer>
                        </template>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </template>
                    
             <!-- Delete Confirmation Modal -->
             <template if:true={isDeleteModalOpen}>
                <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <header class="slds-modal__header" style="color: black;">
                            <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Delete Payment Followup</h2>
                        </header>
                        
                        <div class="slds-modal__content slds-p-around_medium centeralign" >
                            Are you sure you want to delete this  Payment Followup?
                        </div>
                        
                        <!-- Modal Footer -->
                        <footer class="slds-modal__footer">
                            <button class="slds-button slds-button_neutral" onclick={handleDeleteCancel}>No</button>
                            <button class="slds-button slds-button_brand" onclick={deleteCompetition}>Yes</button>
                        </footer>
                    
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </template>

        </template>
    </div>
</template>