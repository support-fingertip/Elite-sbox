<template>
    <!--Beat Card View-->
    <template if:true={isShowBeatData}>
        <div class="outlets">
            <!-- When page is loading -->
            <template lwc:if={isPageLoaded}>
                <div >
                    <c-on-loading-screen></c-on-loading-screen>
                </div>
            </template>
            <!-- When page loaded -->
            <template lwc:else>
                <div class="route"> 
                    <!--Search Bar-->
                    <div class="route-filters">
                        <lightning-input 
                            type="search" 
                            placeholder="Search Beats...."
                            value={searchedbeatVale} 
                            onchange={searchBeats}
                            class="slds-input_bare slds-border_none textField">
                        </lightning-input>
                    </div>
                    <!--Beats Card View-->
                    <template  for:each={beatData} for:item="item" for:index="index">
                        <div class="route-outlets" key={item.beatId}>
                            <div class="borderLine slds-m-top_small">
                                <div  class="route-outlet">
                                    <!--Beat Name-->
                                    <div class="route-left">
                                        <div class="outlet-title">
                                            <span class="icon-wrapper">
                                                <img src={googleIcons.beat} class="custom-icon" width="20" height="20" />
                                            </span>&nbsp;     
                                            <div class="beat-name-wrapper">       
                                                <b>{item.beatName}
                                                &nbsp;
                                                <!--Assigned Beat-->
                                                <template lwc:if={item.istodayBeat}>
                                                    (Assigned)
                                                </template>
                                                </b>
                                            </div>  
                                        </div>
                                        <div class="outlet-title" style="padding-left:14px"> 
                                                &nbsp;&nbsp; Status :  &nbsp;
                                                   <!--Current Beat-->
                                                <template lwc:if={item.isCurrentBeat}>
                                                    Inprogress
                                                   &nbsp;
                                                    <span class="icon-margin-bottom">
                                                        <lightning-icon 
                                                            icon-name="utility:clock" 
                                                            size="x-small" 
                                                            alternative-text=""
                                                            class="cloclColor">
                                                        </lightning-icon>
                                                    </span>
                                                </template> 
                                                <template lwc:else>
                                                    Planned
                                                </template>
                                        </div>
                                        <div class="outlet-title" style="padding-left:14px"> &nbsp;&nbsp; Date : {item.pjpDate} </div>
                                    </div>        
                                    <!--Left side Icons-->                                       
                                    <div class="outlet-icon" >
                                        <template lwc:if={isDayStarted}>
                                            <!-- Forward Icon for Current Beat -->
                                            <template if:true={item.isCurrentBeat}>
                                                <div class="icon-container">
                                                    <div onclick={handleOnclickMenu}
                                                        data-id={item.beatId}
                                                        data-pjpid={item.pjpId}
                                                        data-index={index}
                                                        data-name="Execute_Beat"
                                                        data-beatname={item.beatName}>
                                                        <img src={googleIcons.forward} width="23" height="23">
                                                    </div>
                                                </div>
                                            </template>

                                            <!-- Play Icon Logic -->
                                            <template if:false={item.isCurrentBeat}>
                                                <!-- 1. Show Play for today beat when no current beat exists -->
                                                <template if:true={item.istodayBeat}>
                                                    <template if:false={isCurrentBeatExisted}>
                                                        <div class="icon-container">
                                                            <div onclick={handleOnclickMenu}
                                                                data-id={item.beatId}
                                                                data-pjpid={item.pjpId}
                                                                data-index={index}
                                                                data-name="Start_Beat"
                                                                data-beatname={item.beatName}>
                                                                <img src={googleIcons.play} width="23" height="23">
                                                            </div>
                                                        </div>
                                                    </template>
                                                </template>

                                                <!-- 2. Show Play for all beats if no current beat and no today beat exists -->
                                                <template if:false={isCurrentBeatExisted}>
                                                    <template if:false={isTodayBeatExisted}>
                                                        <div class="icon-container">
                                                            <div onclick={handleOnclickMenu}
                                                                data-id={item.beatId}
                                                                data-pjpid={item.pjpId}
                                                                data-index={index}
                                                                data-name="Start_Beat"
                                                                data-beatname={item.beatName}>
                                                                <img src={googleIcons.play} width="23" height="23">
                                                            </div>
                                                        </div>
                                                    </template>
                                                </template>
                                            </template>

                                            <!-- Switch Icon Logic -->
                                            <template if:false={item.isCurrentBeat}>
                                                <!--this item is for Not today beat-->
                                                <template if:false={item.istodayBeat}>
                                                    <!--If today beat any tday beat existed-->
                                                    <template if:true={isTodayBeatExisted}>
                                                        <div class="icon-container">
                                                            <div onclick={handleOnclickMenu}
                                                                data-id={item.beatId}
                                                                data-pjpid={item.pjpId}
                                                                data-index={index}
                                                                data-name="Switch_Beat"
                                                                data-beatname={item.beatName}>
                                                                <img src={googleIcons.switch} width="23" height="23">
                                                            </div>
                                                        </div>
                                                    </template>
                                                    <!--If tofay any one today beat not existed but any one current beat existed-->
                                                    <template if:false={isTodayBeatExisted}>
                                                        <template if:true={isCurrentBeatExisted}>
                                                            <div class="icon-container">
                                                                <div onclick={handleOnclickMenu}
                                                                    data-id={item.beatId}
                                                                    data-pjpid={item.pjpId}
                                                                    data-index={index}
                                                                    data-name="Switch_Beat"
                                                                    data-beatname={item.beatName}>
                                                                    <img src={googleIcons.switch} width="23" height="23">
                                                                </div>
                                                            </div>
                                                        </template>
                                                    </template>
                                                </template>

                                                <!--it today beat, but another beat is current -->
                                                <template if:true={item.istodayBeat}>
                                                    <template if:true={isCurrentBeatExisted}>
                                                        <div class="icon-container">
                                                            <div onclick={handleOnclickMenu}
                                                                data-id={item.beatId}
                                                                data-pjpid={item.pjpId}
                                                                data-index={index}
                                                                data-name="Switch_Beat"
                                                                data-beatname={item.beatName}>
                                                                <img src={googleIcons.switch} width="23" height="23">
                                                            </div>
                                                        </div>
                                                    </template>
                                                </template>
                                            </template>
                                            
                                           <!-- <div onclick={openMenu} tabindex="0" data-id={item.id} data-index={index}>
                                                <lightning-icon 
                                                    icon-name="utility:threedots_vertical" 
                                                    size="x-small" 
                                                    alternative-text="" 
                                                    class="chevron-icon-ex"
                                                    data-id={item.id}
                                                    data-index={index}>
                                                </lightning-icon>
                                          
                                                <template lwc:if={item.openPopup}>
                                                    <div class="popup" >
                                                        <ul>
                                                            <li onclick={handleOnclickMenu} data-name="Preview"
                                                             data-id={item.beatId} data-index={index}
                                                                    data-pjpid={item.pjpId}>
                                                                <i class="material-symbols-outlined">
                                                                    <lightning-icon 
                                                                        icon-name="utility:preview" 
                                                                        size="x-small" 
                                                                        alternative-text="Preview"
                                                                        class="invert-image" >
                                                                    </lightning-icon>
                                                                </i>
                                                                Preview
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </template>
                                            </div>-->
                                        </template>
                                    </div>                                    
                                </div>   
                            </div>
                        </div>
                    </template>
                </div>
            </template>
        </div>
    </template>

    <!--Preview Beat Customers-->
    <template lwc:if={isShowPreview}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <div class={containerClass}>
                <!--Close Icon-->
                <template lwc:if={isDesktop}>
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" onclick={closePreview}>
                        <lightning-icon icon-name="utility:close" size="small"></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                </template>

                <!--Header-->
                <div class="slds-modal__header">
                    <div class="slds-grid slds-gutters slds-grid_align-center slds-grid_vertical-align-center">
                        <template if:false={isDesktop}>
                            <div class="slds-col  slds-clearfix mobile-button">
                                <div class="slds-float_right">
                                    <lightning-button variant="base" label="Cancel" disabled={isDisabled} onclick={closePreview} class="slds-m-left_x-small"></lightning-button>
                                </div>
                            </div>
                        </template>
                        <div class="slds-col slds-align_absolute-center mobile-header">
                            <h1 id="modal-heading-03" class="slds-modal__title slds-hyphenate" tabindex="-1">Preview Customers</h1>
                        </div>
                        <template if:false={isDesktop}>
                            <div class="slds-col  slds-clearfix mobile-button">
                                <div class="slds-float_left">
                                    <lightning-button variant="base" label="Close" disabled={isDisabled}  onclick={closePreview} class="slds-m-left_x-small"></lightning-button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Body -->
                <div class="slds-modal__content slds-p-around_medium visitPopup" id="modal-content-id-3">
                    <!-- Spinner -->
                    <template lwc:if={isLoading}>
                        <div style="overflow: hidden;">
                            <c-loading-screen size={loadingScreenSize}></c-loading-screen>
                        </div>
                    </template>
                    <template lwc:else>
                        <div class="slds-grid slds-wrap">
                            <template for:each={previewBeatList} for:item="item" for:index="index">
                                <div key={item.Id} class={previewClass}>
                                    <div class="slds-card custom-card">
                                        <div class="slds-p-around_medium">
                                            <div class="slds-grid slds-align-center">
                                                <span class="icon-wrapper slds-m-right_small">
                                                    <img src={googleIcons.account} class="custom-icon" width="20" height="20" />
                                                </span>
                                                <h3 class="slds-text-heading_small slds-m-bottom_x-small">{item.Name}</h3>
                                            </div>
                                            <p class="slds-text-body_regular">Customer Type : {item.Customer_Type__c}</p>
                                            <p class="slds-text-body_regular">Street : {item.Street__c}</p>
                                        </div>

                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>


                <!-- Footer for visit poup -->
                <template lwc:if={isDesktop}>
                    <div class="slds-modal__footer" style="text-align: center;">
                        <button class="slds-button slds-button_brand" onclick={closePreview} disabled={isDisabled}>Close</button>
                    </div>
                </template>

            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
    </template>

    <!--Swith Beat Popup-->
    <template lwc:if={isShowSwitchBeat}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <div class={containerClass}>
                <!--Close Icon-->
                <template lwc:if={isDesktop}>
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" onclick={closePopup}>
                        <lightning-icon icon-name="utility:close" size="small"></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                </template>

                <!--Header-->
                <div class="slds-modal__header">
                    <div class="slds-grid slds-gutters slds-grid_align-center slds-grid_vertical-align-center">
                        <template if:false={isDesktop}>
                            <div class="slds-col  slds-clearfix mobile-button">
                                <div class="slds-float_right">
                                    <lightning-button variant="base" label="Cancel" disabled={isDisabled} onclick={closePopup} class="slds-m-left_x-small"></lightning-button>
                                </div>
                            </div>
                        </template>
    
                        <div class="slds-col slds-align_absolute-center mobile-header">
                            <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate" tabindex="-1">Switch Beat</h1>
                        </div>

                        <template if:false={isDesktop}>
                            <div class="slds-col  slds-clearfix mobile-button">
                                <div class="slds-float_left">
                                    <lightning-button variant="base" label="Switch" disabled={isDisabled}  onclick={switchBeat} class="slds-m-left_x-small"></lightning-button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!--Body-->
                <div class="slds-modal__content slds-p-around_medium visitPopup" id="modal-content-id-2">
                    <!-- Spinner -->
                    <template lwc:if={isLoading}>
                        <div style="overflow: hidden;">
                            <c-loading-screen size={loadingScreenSize} ></c-loading-screen>
                        </div>
                    </template>
                    <template lwc:else>
                        <lightning-textarea
                            name="beatSwitchReason"
                            label="Reason for Switching the Beat"
                            data-id="beatSwitchReason"
                            value={beatSwitchReason}
                            placeholder="Enter Reason for Switching the Beat..."
                            onchange={handleInputChange} 
                            required>
                        </lightning-textarea>
                    </template>
                </div>

                <!-- Footer for visit poup -->
                <template lwc:if={isDesktop}>
                    <div class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" aria-label="Cancel" onclick={closePopup} disabled={isDisabled}>Cancel</button>
                        <button class="slds-button slds-button_brand" onclick={switchBeat} disabled={isDisabled} >Switch</button>
                    </div>
                </template>

            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
    </template>

    <!--Confirmation Modal -->
    <template if:true={isShowConfirmation}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header  mobile-header" style="color: black;background-color:white">
                    <h2 id="modal-heading-02" class="slds-modal__title slds-hyphenate">Start Beat</h2>
                </header>
                <div class="slds-modal__content slds-p-around_medium centeralign" style="text-align: center;">
                    <template lwc:if={isLoading}>
                        <div style="overflow: hidden;">
                            <c-loading-screen size={loadingScreenSize} ></c-loading-screen>
                        </div>
                    </template>
                    <template lwc:else>
                        Are you sure you want to start the beat?
                    </template>
                </div>
                <!-- Modal Footer -->
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" onclick={handleConfirmationNo}>No</button>
                    <button class="slds-button slds-button_brand" onclick={handleConfirmationYes}>Yes</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
</template>