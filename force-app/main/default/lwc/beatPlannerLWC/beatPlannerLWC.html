<template>
    <!--Main Component-->
    <template lwc:if={isvisitDesktop}>
        <div class="custom1">
            <div class={beatPlannercontainerClass}> 
                <!-- When page is loading -->
                <template lwc:if={isPageLoaded}> 
                    <div style="margin:5px;">
                        <c-on-loading-screen></c-on-loading-screen>
                    </div>
                </template>

                <!-- When page loaded -->
                <template lwc:else>
                    <template lwc:if={isAllowedDevice}>
                        <!--Header-->
                        <div class={navBarClass}>
                            <template lwc:if={isShowBackButton}>
                                <!--Back Icon-->
                                <i class="material-icons screen-bar-nav-icon" onclick={goBackScreen}>
                                <lightning-icon  icon-name="utility:back" size="small" alternative-text="Back" class=""></lightning-icon>
                                </i>
                            </template>
                            <template lwc:else>
                                <!--Refresh Icon-->
                                <i class="material-icons screen-bar-nav-icon" onclick={refreshData}>
                                <lightning-icon  icon-name="utility:refresh" size="small" alternative-text="refresh" class=""></lightning-icon>
                                </i>
                            </template>

                            <!--Header Name-->
                            <template if:false={isProductScreen}>
                                <span class="header slds-align_absolute-center">{header}</span>
                            </template>
                            <!--Buttons-->
                            <template lwc:if={isDailyLog}>
                                <div class="slds-grid slds-gutters">
                                    <template if:false={outletPage}>
                                        <div class="slds-col">
                                            <h4 class="nav-title menu-close" onclick={isStartEndDay}>{buttonName}</h4>
                                        </div>
                                        <template lwc:if={isVisitCreate}>
                                            <div class="slds-col"> 
                                                <h4 class="nav-title menu-close" onclick={switchBeat}>Switch Beat</h4>
                                            </div>
                                        </template>
                                    </template>
                                    <template if:true={outletPage}>
                                        
                                        <template lwc:if={executeScreenData.isInProgress}>
                                            <template if:true={isExecuteScreen}>
                                                <div class="slds-col"> 
                                                    <h4 class="nav-title menu-close" onclick={completeVisit}>Complete Visit</h4>
                                                </div>
                                            </template>
                                        </template>
                                    </template>
                                </div>
                            </template>
                            <template lwc:else>
                                <h4 class="nav-title">Day Ended</h4>
                            </template>
                        </div>

                        <!--Body-->
                        <div class="screen-1-body">
                            
                            <!-- Beat Screen View -->
                            <template lwc:if={isBeatViewScreen}>
                                <c-beat-screen onprocessbeatevent={handleBeatCustomEvent}></c-beat-screen>
                            </template>

                            <!-- Visit screen view -->
                            <template lwc:if={Outlet}>
                                <c-outlet-screen2 is-desktop={isDesktop} screen-height={screenHeight} current-beat-id={currentBeatId}
                                onmycustomevent={handleCustomEvent} is-parent-comp="true" onbeatcheck={handleBeatCheck} ></c-outlet-screen2>
                            </template>
        
                            <!-- Execute Screen -->
                            <template lwc:if={isExecuteScreen}>
                                <c-execute-screen3 record-id={recordId} account-id={acccountId} index={index} onscreen3={handleProductScreen} is-progress-visit={executeScreenData.isProgressVisit} 
                                    is-acc={executeScreenData.isAcc} is-completed={executeScreenData.isCompleted} is-in-progress={executeScreenData.isInProgress} visit-parent-data={visitData} is-desktop={isDesktop}
                                    isplay-button-clicked={isplayButtonClicked} is-primary-customer={executeScreenData.isPrimaryCustomer} is-promoter={isPromoter}
                                    checkin-data={checkinData}>
                                </c-execute-screen3>
                            </template>
        
                            <!-- Product screen -->
                            <template lwc:if={isProductScreen}>
                                <div lwc:if={recordId}>
                                    <c-product-screen4 record-id={recordId} index={index} onscreen4={handleOrderScreen} log-id={currentLogId} acccount-id={acccountId} obj-type={header} visit-data={visitData}></c-product-screen4>
                                </div>
                            </template>

                            <!--Stock-->
                            <template lwc:if={isStockScreen}>
                                <div lwc:if={recordId}>
                                    <c-stock-screen4 record-id={recordId} index={index} onscreen4={handleOrderScreen} log-id={currentLogId} acccount-id={acccountId} obj-type={header} visit-data={visitData}></c-stock-screen4>
                                </div>
                            </template>

                            <!-- Collections -->
                            <template lwc:if={isCollectionsScreen}>
                                <c-collections record-id={recordId} index={index} onscreen4={handleOrderScreen} 
                                log-id={currentLogId} acccount-id={acccountId} obj-type={header} visit-data={visitData}
                                is-primary-customer={executeScreenData.isPrimaryCustomer}> </c-collections>
                            </template>

                            <!-- display Format  Screen -->
                            <template lwc:if={isDisplayScreen}>
                                <c-display-format-screen  visit-id={recordId} is-desktop={isDesktop} record-id={acccountId} visit-data={visitData}></c-display-format-screen>
                            </template>

                            <!-- Order Fulfillments Screen -->
                            <template lwc:if={isOrderFulfillment}>
                                <c-order-ful-fillmentscreen   onorderfulfillment={handleProductScreen} visit-id={recordId} is-desktop={isDesktop} record-id={acccountId} visit-data={visitData}></c-order-ful-fillmentscreen>
                            </template>

                            <!-- Order Line items Fulfillments Screen -->
                            <template lwc:if={isOrderLineItemFulfillment}>
                                <c-oder-line-item-screen onscreen4={handleOrderScreen}   visit-id={visitId} order-id={currentOrderId} is-desktop={isDesktop}  record-id={acccountId} visit-data={visitData}></c-oder-line-item-screen>
                            </template>

                            <!-- Competition screen -->
                            <template lwc:if={isCometitionScreen}>
                                <div lwc:if={recordId}>
                                    <c-competition-screen7 visit-id={recordId} is-desktop={isDesktop} record-id={acccountId} visit-data={visitData}></c-competition-screen7>
                                </div>
                            </template>

                            <!-- Business Summary -->
                            <template lwc:if={isBusinessSummaryScreen}>
                                <div lwc:if={recordId}>
                                    <c-business-summary visit-id={recordId} is-desktop={isDesktop} obj-name={objName}></c-business-summary>
                                </div>
                            </template>

                            <!-- Camera screen -->
                        <!--- <template lwc:if={isCameraScreen}>
                                <div lwc:if={recordId}>
                                    <c-camera-screen record-id={recordId} is-desktop={isDesktop} open-camera-value=true visit-data={visitData} onmyvisitclick={handleOrderScreen}></c-camera-screen>
                                </div>
                            </template>-->

                            <!--Returns-->
                            <template lwc:if={isReturnScreen}>
                                <div lwc:if={recordId}>
                                    <c-returns-screen record-id={recordId} index={index} onscreen4={handleOrderScreen} 
                                    log-id={currentLogId} acccount-id={acccountId} obj-type={header} visit-data={visitData}>
                                    </c-returns-screen>
                                </div>
                            </template>

                            <!--Shelf Stock-->
                            <template lwc:if={isShelfStockScreen}>
                            <div lwc:if={recordId}>
                            <c-shelf-stock-screen  record-id={recordId} index={index} onscreen4={handleOrderScreen} 
                            log-id={currentLogId} acccount-id={acccountId} obj-type={header} visit-data={visitData}>
                            </c-shelf-stock-screen>
                            </div>
                            </template>
                        </div>
                    </template>
                    <template lwc:else>
                        <div class="slds-size_1-of-1" style="padding:10px;padding-top:60px;display: flex; justify-content: center; align-items: center; font-size: var(--lwc-fontSize9, 1.55rem); font-weight: 700; color: darkgrey;">
                            {deviceRestictionMessage}
                        </div>
                    </template>
    
                </template>               
            </div>
        </div>
        
    </template> 

    <!-- Visit popup -->
    <template lwc:if={newVisitPoup}>
        <c-create-visit-popup daily-log-id={currentLogId} is-desktop={isDesktop} onmyvisitclick={onClickVisitPopup} new-visit-create={newVisitPoup}></c-create-visit-popup>
    </template>

    <!-- Daily log popup -->
    <template lwc:if={isDailyLogPopup}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <div class={containerClass}>
                <!--Close Icon-->
                <template lwc:if={isDesktop}>
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" onclick={closeDailypopup}>
                        <lightning-icon icon-name="utility:close" size="small"></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                </template>

                <!--Header-->
                <div class="slds-modal__header">
                    <div class="slds-grid slds-gutters  slds-grid_align-center slds-grid_vertical-align-center">
                        <template if:false={isDesktop}>
                            <div class="slds-col  slds-clearfix mobile-button">
                                <div class="slds-float_right">
                                    <lightning-button variant="base" label="Cancel" disabled={isDisabled} onclick={closeDailypopup} class="slds-m-left_x-small"></lightning-button>
                                </div>
                            </div>
                        </template>
    
                        <div class="slds-col slds-align_absolute-center mobile-header">
                            <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate " tabindex="-1">{buttonName}</h1>
                        </div>

                        <template if:false={isDesktop}>
                            <div class="slds-col  slds-clearfix mobile-button">
                                <div class="slds-float_left">
                                    <lightning-button variant="base" label="Save" disabled={isDisabled}  onclick={saveDailyLogLocation} class="slds-m-left_x-small"></lightning-button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!--Body-->
                <div class="slds-modal__content slds-p-around_medium dailylogPopup" id="modal-content-id-1">
                    <!-- Spinner -->
                    <template lwc:if={isLoading}>
                        <div style="overflow: hidden;">
                            <c-loading-screen size={loadingScreenSize} ></c-loading-screen>
                        </div>
                    </template>
                    <template lwc:else>
                        <!--Content-->
                        <template if:false={showCameraModal}>
                            <!--Start Day-->
                            <template lwc:if={isStartDay}>
                                <!--Purpose of Visit-->
                                <lightning-combobox
                                    id="purposeOfVisit"
                                    label="Today's Work Plan"
                                    data-id="dailylogFields"
                                    name="Purpose_of_Visit__c"
                                    value={dailylogData.Purpose_of_Visit__c}
                                    message-when-value-missing="Select Today's Work Plan"
                                    options={purposeofVisitOptions}
                                    dropdown-alignment="auto"
                                    placeholder="--None--"
                                    required
                                    disabled={isSSA_DSM}
                                    onchange={handleDailylogInputChange}>
                                </lightning-combobox>
                                <!--Travel Type-->
                                <template if:false={isSSA_DSM}>   
                                    <!--Travel Type-->
                                    <lightning-combobox
                                        id="travelType"
                                        label="Travel Type"
                                        data-id="dailylogFields"
                                        name="Travel_Type__c"
                                        message-when-value-missing="Select Travel Type"
                                        value={dailylogData.Travel_Type__c}
                                        options={travelTypeOptions}
                                        dropdown-alignment="auto"
                                        placeholder="--None--"
                                        required
                                        onchange={handleDailylogInputChange}>
                                    </lightning-combobox>
                                    <!--Comments-->
                                    <template if:true={isShowOtherTravelType}>
                                        <lightning-textarea
                                            required
                                            autocomplete="true"
                                            label="Other Travel Type"
                                            name="Comments__c"
                                            data-id="dailylogFields"
                                            placeholder="Enter Other Travel Type"
                                            value={dailylogData.Comments__c}
                                            onchange={handleDailylogInputChange}>
                                        </lightning-textarea>
                                    </template>
                                </template>
                                <!--Vehicle_Used__c-->
                                <lightning-combobox
                                    id="Vehicle_Used__c"
                                    label="Vehicle Used"
                                    data-id="dailylogFields"
                                    name="Vehicle_Used__c"
                                    value={dailylogData.Vehicle_Used__c}
                                    message-when-value-missing="Select Vehicle Used"
                                    options={vehicleUsedOptions}
                                    dropdown-alignment="auto"
                                    placeholder="--None--"
                                    required
                                    onchange={handleDailylogInputChange}>
                                </lightning-combobox>
                                <!--Odometer Reading-->
                                <lightning-input type="number"
                                    required ={isstartodometermandatory}
                                    autocomplete="true"
                                    label="Start Day Odometer Reading (KM)" 
                                    name="Start_Day_Odometer_Reading_KM__c"
                                    data-id="dailylogFields"
                                    placeholder="Enter Odometer Reading"
                                    value={dailylogData.Start_Day_Odometer_Reading_KM__c} 
                                    onchange={handleDailylogInputChange}>
                                </lightning-input>

                            </template>
                            <!--End Day-->
                            <template lwc:else>
                                <div class="slds-modal__content centeralign" style="text-align: center;padding-bottom:10px">
                                   <b> You are about to End the Day, Are you Sure? </b>
                                </div>
                                <!--Odometer Reading-->
                                <lightning-input type="number"
                                    required ={isEndOdomterMandatory}
                                    autocomplete="true"
                                    label="End Day Odometer Reading (KM)" 
                                    name="End_Day_Odometer_Reading_KM__c"
                                    data-id="dailylogFields"
                                    placeholder="Enter Odometer Reading"
                                    value={dailylogData.End_Day_Odometer_Reading_KM__c} 
                                    onchange={handleDailylogInputChange}>
                                </lightning-input>
                            </template>
                        </template>
                        <!--capture image-->
                        <template if:true={showCameraModal}>
                            <c-capture-image-lwc
                                record-id={userId}
                                unique-id={uniqueId}
                                open-camera-value={isCameraOpen}
                                oncamerastopped={handleCameraStopped}
                                lwc:ref="captureImageCmp">
                            </c-capture-image-lwc>
                        </template>
                        <!--File Upload-->
                        <template if:false={showCameraModal}>
                            <div class="slds-text-align_center slds-box" style="margin-top:10px">
                                <template if:true={isDesktop}>
                                    <lightning-file-upload
                                        label=""
                                        record-id={userId}
                                        multiple
                                        onuploadfinished={handleUploadFinished}>
                                    </lightning-file-upload>
                                </template>
                                <template if:true={isPhone}>
                                    <div class="icon-container" onclick={openCamera}>
                                        <lightning-icon icon-name="action:add_photo_video" size="small" class="icon"></lightning-icon>
                                        <div class="icon-label">Open Camera</div>
                                    </div>
                                </template>
                                <!--Uploaded Files-->
                                <template if:true={showUploadedFiles}>
                                    <table class="slds-table slds-table_bordered slds-table_fixed-layout slds-m-top_small slds-m-bottom_small">
                                        <tbody>
                                            <template for:each={uploadedFiles} for:item="file">
                                                <tr key={file.Id}>
                                                    <td class="slds-cell-wrap" width="80%">
                                                        <a href="javascript:void(0);" data-id={file.Id} onclick={previewFile}>
                                                            {file.Title}
                                                        </a>
                                                    </td>
                                                    <td width="20%">
                                                        <lightning-button-icon
                                                            icon-name="utility:delete"
                                                            data-id={file.Id}
                                                            onclick={deleteFile}
                                                            alternative-text="Delete"
                                                            title="Delete"
                                                        ></lightning-button-icon>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </template>
                            </div>
                        </template>
                    </template>
                </div>

                <!-- Footer for visit poup -->
                <template lwc:if={isDesktop}>
                    <div class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" aria-label="Cancel and close" onclick={closeDailypopup} disabled={isDisabled}>Cancel</button>
                        <button class="slds-button slds-button_brand" onclick={saveDailyLogLocation} disabled={isDisabled} >Save</button>
                    </div>
                </template>

            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
    </template>
    
    <!--Confirmation Modal -->
    <template if:true={isShowConfirmation}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header  mobile-header" style="color: black;background-color:white">
                    <h2 id="modal-heading-02" class="slds-modal__title slds-hyphenate">{confimationheader}</h2>
                </header>
                <div class="slds-modal__content slds-p-around_medium centeralign" style="text-align: center;">
                   {confirmationBody}
                </div>
                <!-- Modal Footer -->
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" onclick={handleConfirmationNo}>No</button>
                    <button class="slds-button slds-button_brand" onclick={handleConfirmationYes}>Yes</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
    
</template>