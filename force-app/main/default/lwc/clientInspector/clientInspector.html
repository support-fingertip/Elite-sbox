<template>
  <lightning-card title="Client Inspector" icon-name="standard:search" class="client-inspector-card">
    <!-- Top Control Section -->
    <div class="control-section slds-p-around_medium slds-grid slds-wrap slds-grid_vertical-align-center slds-box slds-theme_default">

      <!-- Object Selection -->
      <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-2 slds-p-right_small">
        <lightning-combobox
          name="template"
          label="Select Object"
          value={selectedTemplateId}
          placeholder="-- Select Object --"
          options={templateOptions}
          onchange={handleTemplateChange}
          class="slds-size_full"
        ></lightning-combobox>
      </div>


      <!-- Action Buttons -->
      <div class="slds-col slds-size_1-of-1 slds-m-top_small slds-align_absolute-center">
        <lightning-button
          variant="brand"
          label="Run Query"
          onclick={handleRun}
          class="slds-m-right_small"
        ></lightning-button>

        <lightning-button
          variant="neutral"
          label="Stop"
          onclick={handleStop}
          disabled={isStopped}
          class="slds-m-right_small"
        ></lightning-button>

        <lightning-button
          variant="destructive"
          label="Clear"
          onclick={handleClear}
          class="slds-m-right_small"
        ></lightning-button>

        <lightning-button
          variant="success"
          label="Download CSV"
          onclick={downloadCsv}
        ></lightning-button>
      </div>

      <!-- Record Stats -->
      <template if:true={totalCountKnown}>
        <div class="slds-col slds-size_1-of-1 slds-m-top_small slds-text-body_regular slds-text-align_center">
          <strong>Total Records:</strong> {totalCount}
          <span class="slds-m-left_medium">
            <strong>Fetched:</strong> {fetchedCount}
          </span>
        </div>
      </template>
    </div>

    <!-- Table Section -->
    <div class="table-container slds-p-around_medium">
      <template if:true={hasData}>
        <lightning-datatable
          key-field="Id"
          data={datatableData}
          columns={datatableColumns}
          hide-checkbox-column
          resize-column-disabled
          max-column-width="350"
        ></lightning-datatable>
      </template>

      <template if:false={hasData}>
        <div class="slds-text-align_center slds-p-vertical_large slds-text-color_weak">
          No data to display. Please run a query.
        </div>
      </template>
    </div>
  </lightning-card>
</template>